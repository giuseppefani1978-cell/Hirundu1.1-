/* =========================================================
   SALENTO — STYLE GLOBAL (Treasure + Battle)
   - plein écran stable mobile (iOS/Android)
   - HUD et overlays au-dessus du canvas
   - D-pad chasse & pads battle séparés
   - safe areas / notches / dynamic viewport units
   ========================================================= */

/* ---------- Variables & resets ---------- */
:root {
  --bg: #a9d6f5;
  --paper: #fffdf5;
  --ink: #111;
  --accent: #c8b37a;
  --accent-strong: #b08a3c;
  --shadow: rgba(0,0,0,.18);
  --hud-bg: rgba(255,248,220,.96);
  --hud-ink: #000;
  --star: #d26f45;

  /* iOS safe areas (encoches) */
  --safe-top: env(safe-area-inset-top, 0px);
  --safe-right: env(safe-area-inset-right, 0px);
  --safe-bottom: env(safe-area-inset-bottom, 0px);
  --safe-left: env(safe-area-inset-left, 0px);
}

* { box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
html, body { 
  margin:0; padding:0; height:100%; 
  background:var(--bg); color:var(--ink); 
  overflow:hidden; overscroll-behavior:none;
}
body { font-family: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial; }

/* Stabilise le viewport mobile (barres dynamiques) */
.wrap, .game { height: 100dvh; }
@supports (height: 100svh) { .wrap, .game { height: 100svh; } }
.game { position: relative; overflow: hidden; }
/* =========================================================
   ---------- CANVAS : chasse vs battle ----------
   ========================================================= */

/* --- CHASSE (par défaut) : canvas calé dans .game, sous la HUD --- */
canvas#c {
  position: absolute;
  inset: 0;
  z-index: 1;          /* sous la HUD */
  width: 100%;
  height: 100%;
  display: block;
  background: #bfe2f8;
  touch-action: none;
}

/* --- BATTLE : quand body a .mode-battle, plein écran fiable --- */
body.mode-battle canvas#c {
  position: fixed;
  inset: 0;
  z-index: 10002;      /* sous les pads battle (10003) */
  width: 100vw;
  height: 100dvh;
}
@supports (height: 100svh) {
  body.mode-battle canvas#c { height: 100svh; }
}

/* Empêche les overlays/pads de faire scroller */
#touch, #__battle_ui__, #__battle_rotate__ { touch-action:none; }

/* =========================================================
   ---------- Overlay Start ----------
   ========================================================= */
.overlay {
  position:absolute; inset:0; z-index:50;
  display:flex; align-items:center; justify-content:center;
  background: rgba(169,214,245,.84);
  backdrop-filter: blur(3px);
  padding: max(10px, var(--safe-top)) max(10px, var(--safe-right)) max(10px, var(--safe-bottom)) max(10px, var(--safe-left));
}
.card {
  width:min(560px,92vw);
  border:2px solid var(--accent); border-radius:14px;
  background:var(--paper); box-shadow:0 10px 26px var(--shadow);
  padding:18px; text-align:center;
}
.card h1{ margin:0 0 6px; font-size:24px; }
.card p{ margin:6px 0 14px; opacity:.82; }
.card button {
  border:1px solid var(--accent);
  background:#ffe8a6; border-radius:10px;
  padding:12px 16px; font-weight:700; cursor:pointer;
}
.card button:focus-visible{ outline:2px solid #3a86ff; outline-offset: 2px; }

/* Intro anim — Aracne & Tarantula */
.heroes {
  display:flex; justify-content:center; gap:16px;
  margin:10px 0 8px; position:relative;
}
.heroes img {
  width:72px; height:72px; object-fit:contain;
  image-rendering:pixelated; image-rendering:crisp-edges;
  filter: drop-shadow(0 3px 6px rgba(0,0,0,.25));
  animation: floatY 2.4s ease-in-out infinite, pulse 3.2s ease-in-out infinite;
}
.heroes img#heroAr { animation-delay:.0s,.0s; }
.heroes img#heroTa { animation-delay:.6s,.3s; }

@keyframes floatY{ 0%{transform:translateY(0)}50%{transform:translateY(-6px)}100%{transform:translateY(0)} }
@keyframes pulse{ 0%,100%{transform:scale(1)}50%{transform:scale(1.05)} }

@media (prefers-reduced-motion: reduce){
  .heroes img{ animation: none; }
  .overlay, .card{ transition: none !important; }
}

/* =========================================================
   ---------- HUD (colonne étroite) ----------
   ========================================================= */
.hud {
  position:absolute; z-index:22;
  left: calc(8px + var(--safe-left)); top:50%; transform: translateY(-50%);
  width:42px;
  background: var(--hud-bg);
  color:var(--hud-ink);
  border:2px solid var(--accent); border-radius:10px;
  padding:8px 6px;
  display:flex; flex-direction:column; align-items:center; gap:6px;
}
.hud h3{ margin:0; font-size:14px; line-height:1; text-align:center; }
.hud .score{ margin:0; font-weight:800; font-size:13px; line-height:1.1; }
.stars{ display:flex; flex-direction:column; gap:4px; margin-top:2px; align-items:center; }
.star{ width:15px; height:15px; opacity:.95; }

/* =========================================================
   ---------- Bulle Tarantula ----------
   ========================================================= */
.tarTop {
  position:absolute; z-index:40; display:none;
  left: calc(8px + var(--safe-left)); top: calc(8px + var(--safe-top));
  max-width: calc(100vw - 16px - var(--safe-left) - var(--safe-right));
  align-items:flex-start; gap:8px;
}
.tarTop.show{ display:flex; }
.tarTop img {
  width:56px; height:56px; object-fit:contain; image-rendering:pixelated;
  background:transparent; border:none; border-radius:0; box-shadow:none;
}
.bdBubble {
  max-width:min(860px,92vw); background:#fff; border:1px solid #bbb; border-radius:12px;
  padding:8px 10px; box-shadow:0 4px 10px rgba(0,0,0,.12);
  font-size:14px; line-height:1.35;
}
.bdTitle{ font-weight:700; margin:0 0 4px; }
.bdBubble p{ margin:0; }

/* =========================================================
   ---------- D-pad Chasse (#touch) ----------
   ========================================================= */
.touch {
  position:absolute; z-index:30; display:none;
  left:50%; transform:translateX(-50%);
  bottom: calc(10px + var(--safe-bottom));
  gap:12px; align-items:center;
}
.touch.show{ display:flex; }
.dpad {
  display:grid; grid-template-columns:56px 56px 56px; grid-template-rows:56px 56px 56px; gap:10px;
}
.btn {
  width:56px; height:56px; border-radius:12px; border:2px solid var(--accent);
  background:#fff7de; display:flex; align-items:center; justify-content:center;
  user-select:none; touch-action:none; font-weight:800; font-size:20px;
  box-shadow:0 3px 0 var(--accent);
}
.btn:active{ transform:translateY(1px); }

/* =========================================================
   ---------- Boutons flottants ----------
   ========================================================= */
#musicBtn {
  position: fixed; z-index:10000;
  right: calc(8px + var(--safe-right));
  bottom: calc(48px + var(--safe-bottom));
  font: 14px/1.1 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  padding: 8px 10px; border-radius: 8px;
  border: 1px solid #bfa86a; background: #fff8dc;
  box-shadow: 0 2px 0 rgba(0,0,0,.15); cursor: pointer;
}
#musicBtn.on  { background:#f6ffe5; border-color:#93c572; }
#musicBtn.off { background:#ffecec; border-color:#d49090; }
#musicBtn:focus-visible{ outline:2px solid #3a86ff; outline-offset:2px; }

#replayFloat {
  position:fixed; z-index:10001;
  right: calc(8px + var(--safe-right));
  bottom: calc(16px + var(--safe-bottom));
  padding: 8px 10px; border-radius: 8px; border:1px solid var(--accent-strong);
  background:#fff; cursor:pointer;
}

/* =========================================================
   ---------- Battle UI (injectée par battle.js) ----------
   ========================================================= */
#__battle_ui__{ position:fixed; inset:0; z-index:10003; pointer-events:none; display:none; }
#__battle_ui__ > div{ pointer-events:auto; margin-bottom:max(0px, var(--safe-bottom)); }
#__battle_rotate__ {
  display:none; align-items:center; justify-content:center;
  background:rgba(0,0,0,.75); color:#fff; font:700 18px system-ui;
  text-align:center; padding:20px;
}

/* =========================================================
   ---------- Divers ----------
   ========================================================= */
#__ver__{
  position:fixed; right: calc(8px + var(--safe-right)); bottom: calc(8px + var(--safe-bottom));
  z-index:9999; background:rgba(0,0,0,.55); color:#fff;
  font:12px system-ui; padding:4px 6px; border-radius:6px; pointer-events:none;
}

/* Responsif */
@media (max-width: 420px){
  .card h1{ font-size:20px; }
  .heroes img{ width:64px; height:64px; }
  .hud{ left: calc(6px + var(--safe-left)); }
  .dpad{ grid-template-columns:52px 52px 52px; grid-template-rows:52px 52px 52px; gap:8px; }
  .btn{ width:52px; height:52px; font-size:18px; }
}

/* Thème sombre */
@media (prefers-color-scheme: dark){
  :root{ --paper:#fcfbf6; --ink:#111; }
  #musicBtn, #replayFloat{ background:#fffdf7; }
}

/* === État combat : masque l’UI carte et affiche les pads de battle === */
body.mode-battle .hud,
body.mode-battle #touch,
body.mode-battle .overlay,
body.mode-battle #replayFloat,
body.mode-battle #musicBtn,
body.mode-battle #__ver__,
body.mode-battle #__score_live {
  display: none !important;
}
